---
service_directory: "immich"
image: "ghcr.io/immich-app/immich-server:v1.102.2"
urls_url: "{{ urls.immich }}"

state: "started"

docker_postgres_image: "tensorchord/pgvecto-rs:pg14-v0.1.11"
docker_postgres_user: "{{ lookup('get_secrets', path='/immich', secret_name='IMMICH_POSTGRES_USER') }}"
docker_postgres_password: "{{ lookup('get_secrets', path='/immich', secret_name='IMMICH_POSTGRES_PASSWORD') }}"
docker_postgres_db: "{{ service_directory }}"
docker_postgres_location: "{{ location.docker_data }}/{{ service_directory }}/db"

docker_name: "{{ service_directory }}-microservices"
docker_entrypoint:
  - "/bin/sh"
  - "./start-microservices.sh"
docker_volumes:
  - "{{ location.pictures }}:/usr/src/app/upload"
docker_env:
  TYPESENlerverSE_API_KEY: "{{ typesense.api_key }}"
  DB_HOSTNAME: "{{ service_directory }}-postgres"
  DB_DATABASE_NAME: "{{ service_directory }}"
  REDIS_HOSTNAME: "{{ service_directory }}-redis"
  UPLOAD_LOCATION: "{{ location.pictures }}"
  PUBLIC_LOGIN_PAGE_MESSAGE: ""
  IMMICH_WEB_URL: "http://{{ service_directory }}-web:3000"
  IMMICH_SERVER_URL: "http://{{ service_directory }}-server:3001"
  IMMICH_MACHINE_LEARNING_URL: "http://{{ service_directory }}-machine-learning:3003"
  DB_USERNAME: "{{ docker_postgres_user }}"
  DB_PASSWORD: "{{ docker_postgres_password }}"
