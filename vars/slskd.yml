---
service_directory: "slskd"
image: "slskd/slskd:0.20.1"
urls_url: "{{ urls.slskd }}"
state: "started"
config_file: "slskd.yml"

io_port: "{{ lookup('get_secrets', path='/soulseek', secret_name='SLSK_PORT') }}"

web_user: "{{ lookup('get_secrets', path='/soulseek', secret_name='SLSKD_USERNAME') }}"
web_password: "{{ lookup('get_secrets', path='/soulseek', secret_name='SLSKD_PASSWORD') }}"

slsk_user: "{{ lookup('get_secrets', path='/soulseek', secret_name='SLSK_USERNAME') }}"
slsk_password: "{{ lookup('get_secrets', path='/soulseek', secret_name='SLSK_PASSWORD') }}"
files_make:
  - dest: "{{ base_directory }}/{{ service_directory }}"
files_template:
  - src: "{{ config_file }}"
    dest: "{{ base_directory }}/{{ service_directory }}"

traefik_servers:
  - url: "{{ service_directory }}"
    port: "8080"
traefik_middlewares:
  - "internal-ip@file"

homepage_config:
  icon: "https://raw.githubusercontent.com/slskd/slskd/master/src/web/public/favicon.ico"
  description: "Soulseek client"
  category: "Stream"

docker_networks:
  - name: "{{ docker.traefik_network }}"
docker_ports:
  - "{{ io_port }}:{{ io_port }}"
docker_env:
  SLSKD_CONFIG: "/config/slskd.yml"
docker_user: "1000:1000"
docker_volumes:
  - "{{ location.downloads }}/music:/downloads"
  - "{{ location.downloads }}:/incomplete"
  - "{{ location.music }}:/shares:ro"
  - "{{ base_directory }}/{{ service_directory }}/{{ config_file }}:/config/slskd.yml"
  - "{{ location.docker_data }}/{{ service_directory }}:/app"
