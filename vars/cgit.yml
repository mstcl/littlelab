config_file: "cgitrc"
# favicon_file: "favicon.ico" # (optional) place in files/cgit/files
# css_file: "style.css" # (optional) place in files/cgit/files
# about_file: "about.html" # (optional) place in files/cgit/files
# logo_file: "" # (optional) place in files/cgit/files
instance_name: ""

cgit_options:
  syntax_highlighting: false
  about: true # set filename in about_file
  logo: true # set filename in logo_file
  favicon: true # set filename in favicon_file
  css: true # set filename in css_file

docker_container_options:
  state: "{{ state }}"
  networks:
    - name: "{{ docker.traefik_network }}"
  env:
    USE_CUSTOM_CONFIG: "true"
  cap_drop:
    - SYS_ADMIN
    - AUDIT_WRITE
    - MKNOD
    - SYS_CHROOT
    - NET_RAW
    - SETFCAP
    - SYS_PTRACE
    - DAC_OVERRIDE
    - SETPCAP
  volumes:
    - "{{ base_directory }}/{{ service_directory }}/header.html:/usr/lib/cgit/header.html:ro"
    - "{{ location.repos }}:/srv/git:ro"
    - "{{ base_directory }}/{{ service_directory }}/{{ config_file }}:/etc/cgitrc:ro"
    # - "{{ base_directory }}/{{ service_directory }}/{{ favicon_file }}:/usr/share/webapps/cgit/{{ favicon_file }}:ro"
    # - "{{ base_directory }}/{{ service_directory }}/{{ css_file }}:/usr/share/webapps/cgit/{{ css_file }}:ro"
    # - "{{ base_directory }}/{{ service_directory }}/{{ about_file }}:/usr/lib/cgit/{{ about_file }}:ro"
    # - "./{{ logo_file }}:/usr/lib/cgit/{{ logo_file }}:ro"
    # - ./syntax-highlighting.py:/usr/lib/cgit/filters/syntax-highlighting.py:ro

traefik_options:
  servers:
    - url: "{{ service_directory }}"
      port: 80
  rule: "(Host(`{{ expanded_url }}`) && PathPrefix(`/`))"
  additional_content: |2
          priority: 1
        cgit-private-repos:
          rule: "{{ concat_rule }}"
          service: "{{ service_directory }}"
          priority: 10
          tls: *modern
          middlewares:
            - "rewrite-cgit@file"
            - "internal-ip@file"
        cgit-private:
          rule: "Host(`private-{{ expanded_url }}`)"
          service: "{{ service_directory }}"
          tls: *modern
          middlewares:
            - "internal-ip@file"

      middlewares:
        rewrite-cgit:
          redirectRegex:
            regex: "^https://{{ expanded_url }}/(.*)"
            replacement: "https://private-{{ expanded_url }}/${1}"
